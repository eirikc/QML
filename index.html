<!doctype html>
<!--This is an HTML5 document-->
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>QML</title>
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="shortcut icon" href="favicon.ico">

</head>

<body>

    <div class="toolbar">
        <img src="favicon.ico" id="icon" alt="QML" width="auto"
            height="auto">
        <!-- Input field for serial numbers -->
        <input type="text" name="Serial number" placeholder="Serial number" id="sn_id" spellcheck="false" maxlength="12"
            size="11" autofocus />

        <!-- Buttons for Masterloop pages and quick plots.
            Will check if ctrl is pressed and will open a new tab if true -->
        <!--input type="submit" id="btnDevice" value="âž¡ Device" onclick="if(event.ctrlKey) setURLCTRL(); else setURL()"-->
        <button type="submit" id="btnObservations" class="small-buttons" value="Observations" title="Observations"
            onclick="if(event.ctrlKey) ObservationsCTRL(); else if(event.metaKey) ObservationsCTRL(); else Observations()"><img
                src="Observations.svg" class="small-buttons"
                style="float: center; width: 30px;"></button>
        <button type="submit" id="btnSettings" class="small-buttons" value="Settings" title="Settings"
            onclick="if(event.ctrlKey) SettingsCTRL(); else if(event.metaKey) SettingsCTRL(); else Settings()"><img
                src="Settings.svg" class="small-buttons"
                style="float: center; width: 30px;"></button>
        <button type="submit" id="btnCommands" class="small-buttons" class="small-buttons" value="Commands"
            title="Control - Quick commands"
            onclick="if(event.ctrlKey) CommandsCTRL(); else if(event.metaKey) CommandsCTRL(); else Commands()"><img
                src="Control.svg" style="float: center; width: 30px;"></button>
        <button type="submit" id="btnHistory" class="small-buttons" class="small-buttons" value="History"
            title="Command history"
            onclick="if(event.ctrlKey) HistoryCTRL(); else if(event.metaKey) HistoryCTRL(); else History()"><img
                src="Commands.svg" class="small-buttons"
                style="float: center; width: 30px;"></button>
        <button type="submit" id="btnCharging" value="Charging" title="Charging plots"
            onclick="if(event.ctrlKey) chargerPlotsCTRL(); else if(event.metaKey) chargerPlotsCTRL(); else chargerPlots()"><img
                src="favicon.ico" style="float: center; width: 20px;">Charging</button>
        <button type="submit" id="btnNetwork" value="Network" title="Network connectivity plots"
            onclick="if(event.ctrlKey) networkPlotsCTRL(); else if(event.metaKey) networkPlotsCTRL(); else networkPlots()"><img
                src="favicon.ico" style="float: center; width: 20px;">Network</button>
        <button type="submit" id="btnEqualizer" value="Equalizer" title="Equalizer plots"
            onclick="if(event.ctrlKey) equalizerPlotsCTRL(); else if(event.metaKey) equalizerPlotsCTRL(); else equalizerPlots()"><img
                src="favicon.ico" style="float: center; width: 20px;">Equalizer</button>
        <button type="submit" id="btnDerate" value="Derate" title="Derating charger plots"
            onclick="if(event.ctrlKey) deratePlotsCTRL(); else if(event.metaKey) deratePlotsCTRL(); else deratePlots()"><img
                src="favicon.ico" style="float: center; width: 20px;">Derating</button>
        <button type="submit" id="btnList" value="List" title="Charger mode list"
            onclick="if(event.ctrlKey) listPlotsCTRL(); else if(event.metaKey) listPlotsCTRL(); else listPlots()"><img
                src="favicon.ico" style="float: center; width: 20px;">Mode List</button>
        <button type="submit" id="btnPortal" class="long-buttons" value="Portal"
            title="Open the device in the cloud portal (SHIFT+click to open beta portal)"
            onclick="if(event.shiftKey) openPortalSHIFT(); else if(event.ctrlKey) openPortalCTRL(); else if(event.metaKey) openPortalCTRL(); else openPortal()"><img
                src="492x0w.png"
                style="float: center; width: 20px;">Open in portal</button>
        <button type="submit" id="btnPortalInfo" class="mini-buttons" value="Info"
            title="Info in portal (SHIFT+click to open beta One View in portal)"
            onclick="if(event.shiftKey) openPortalInfoSHIFT(); else if(event.ctrlKey) openPortalInfoCTRL(); else if(event.metaKey) openPortalInfoCTRL(); else openPortalInfo()"><img
                src="information-outline.png"
                style="float: center; width: 24px;"></button>
                src="492x0w.png">Open in portal</button>

        <button type="submit" id="btnPortalInfo" class="long-buttons" value="Info"  
            title="Open One View in the cloud portal (SHIFT+click to open in beta portal)"
            onclick="if(event.shiftKey) openPortalInfoSHIFT(); else if(event.ctrlKey) openPortalInfoCTRL(); else if(event.metaKey) openPortalInfoCTRL(); else openPortalInfo()"><svg
                xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24" fill="none"
                xmlns="http://www.w3.org/2000/svg" fit="" preserveAspectRatio="xMidYMid meet" focusable="false">
                <path
                    d="M15.72 20.46C17.6906 19.5293 19.2612 17.9217 20.1458 15.93C21.0303 13.9382 21.1698 11.695 20.5389 9.60903C19.908 7.52305 18.5487 5.73315 16.7086 4.56546C14.8686 3.39778 12.6702 2.93005 10.5141 3.24748C8.35808 3.56491 6.38782 4.64638 4.96235 6.29484C3.53689 7.9433 2.75111 10.049 2.74818 12.2283C2.74525 14.4076 3.52537 16.5154 4.9464 18.1677C6.36743 19.82 8.33478 20.9068 10.49 21.23C10.6717 21.2599 10.8576 21.2509 11.0356 21.2035C11.2135 21.1561 11.3793 21.0715 11.5221 20.9552C11.6648 20.8389 11.7813 20.6936 11.8637 20.5289C11.946 20.3643 11.9925 20.184 12 20V12"
                    stroke-width="1.5px" stroke-linejoin="round" stroke="#F5F5F5" fill="none"></path>
                <path
                    d="M12.58 9.40999C12.58 9.74688 12.3069 10.02 11.97 10.02C11.6331 10.02 11.36 9.74688 11.36 9.40999C11.36 9.07309 11.6331 8.79999 11.97 8.79999C12.3069 8.79999 12.58 9.07309 12.58 9.40999Z"
                    fill="#005AFF" stroke="#F5F5F5" style="float: center; width: 24px;"></path>
            </svg>Open One View</button>
    </div>


    <iframe id="ml_embed" title="Masterloop page" src="https://portal.masterloop.net/#/devices/filter/recent"
        frameborder="0" style="overflow:hidden;height:100%;width:100%" height="100%" width="100%">
    </iframe>

    <script>

        // Spellchecker to ignore everything that isn't characters or numbers
        // and replace lowercase letters with upper case letters.
        document.getElementById('sn_id').addEventListener('input', function () {
            var position = this.selectionStart;
            this.value = this.value.replace(/[^a-zA-Z0-9]+/g, '');
            this.value = this.value.toUpperCase();
            this.selectionEnd = position;
        });


        // Function for Enter-key go to device page
        var serial = document.getElementById("sn_id");
        serial.addEventListener("keydown", function (event) {
            if (event.keyCode === 13) {
                setURL(event);
            }
        });


        // Force focus on the serial number input on redirection
        function forceFocus() {
            var focus = document.getElementById("sn_id").focus();
            let serialInput = document.getElementById('sn_id')
            function focusTime() {
                setTimeout(function () {
                    serialInput.focus();
                }, 100);
            };

            serialInput.addEventListener("blur", focusTime);

            setTimeout(function () {
                serialInput.removeEventListener("blur", focusTime);
            }, 3000);
        }
        // focus text cursor on serial number input on load.
        window.onload = function () {
            forceFocus();
        };


        // Serial number check
        function snCheckEmpty() {
            var sn_value = document.getElementById("sn_id").value;
            if (sn_value === "") {
                return true;
            }
        }
        function snCheck() {
            var sn_value = document.getElementById("sn_id").value;
            var sn_length = document.getElementById("sn_id").value.length;
            if (sn_length === 8 &&
                (sn_value.startsWith("EC") === true
                    || sn_value.startsWith("EH") === true
                    || sn_value.startsWith("UK") === true
                    || sn_value.startsWith("QC") === true
                    || sn_value.startsWith("QP") === true
                    || sn_value.startsWith("EQ") === true
                    || sn_value.startsWith("QH") === true)) {
                return true;
            } else { return false; }
        }
        function snCheckEQ() {
            var sn_value = document.getElementById("sn_id").value;
            var sn_length = document.getElementById("sn_id").value.length;
            if (sn_length === 8 &&
                (sn_value.startsWith("QC") === true
                    || sn_value.startsWith("QP") === true
                    || sn_value.startsWith("EQ") === true
                    || sn_value.startsWith("QH") === true)) {
                return true;
            } else { return false; }
        }


        // Functions for buttons to redirect masterloop embed
        function setURL() {
            var sn_value = document.getElementById("sn_id").value;
            var ml_url = "https://portal.masterloop.net/#/devices/general/" + sn_value;
            forceFocus();
            if (snCheckEmpty()) {
                return false
            }
            else if (snCheck()) {
                document.getElementById("ml_embed").src = ml_url;
            } else {
                alert("Check serial number");
                return false;
            }
        }

        function Observations() {
            var sn_value = document.getElementById("sn_id").value;
            var ml_url = "https://portal.masterloop.net/#/devices/observations/" + sn_value;
            forceFocus();
            if (snCheckEmpty()) {
                return false
            }
            else if (snCheck()) {
                document.getElementById("ml_embed").src = ml_url;
            } else {
                alert("Check serial number");
                return false;
            }
        }

        function Settings() {
            var sn_value = document.getElementById("sn_id").value;
            var ml_url = "https://portal.masterloop.net/#/devices/settings/" + sn_value;
            forceFocus();
            if (snCheckEmpty()) {
                return false
            }
            else if (snCheck()) {
                document.getElementById("ml_embed").src = ml_url;
            } else {
                alert("Check serial number");
                return false;
            }
        }

        function Commands() {
            var sn_value = document.getElementById("sn_id").value;
            var ml_url = "https://portal.masterloop.net/#/devices/quickCommands/" + sn_value;
            forceFocus();
            if (snCheckEmpty()) {
                return false
            }
            else if (snCheck()) {
                document.getElementById("ml_embed").src = ml_url;
            } else {
                alert("Check serial number");
                return false;
            }
        }

        function History() {
            var sn_value = document.getElementById("sn_id").value;
            var ml_url = "https://portal.masterloop.net/#/devices/" + sn_value + "/commandsHistory";
            forceFocus();
            if (snCheckEmpty()) {
                return false
            }
            else if (snCheck()) {
                document.getElementById("ml_embed").src = ml_url;
            } else {
                alert("Check serial number");
                return false;
            }
        }

        function chargerPlots() {
            var sn_value = document.getElementById("sn_id").value;
            var ml_url = "https://portal.masterloop.net/#/devices/observations/" + sn_value + "/plots?filter=[21,38,46,96,104,109,110,114,120,182,183,184,185,194,195,196,197,198,199]";
            forceFocus();
            if (snCheckEmpty()) {
                return false
            }
            else if (snCheck()) {
                document.getElementById("ml_embed").src = ml_url;
            } else {
                alert("Check serial number");
                return false;
            }
        }

        function networkPlots() {
            var sn_value = document.getElementById("sn_id").value;
            var ml_url = "https://portal.masterloop.net/#/devices/observations/" + sn_value + "/plots?filter=[11,46,130,131,132,136,150,141]";
            forceFocus();
            if (snCheckEmpty()) {
                return false
            }
            else if (snCheck()) {
                document.getElementById("ml_embed").src = ml_url;
            } else {
                alert("Check serial number");
                return false;
            }
        }

        function equalizerPlots() {
            var sn_value = document.getElementById("sn_id").value;
            var ml_url = "https://portal.masterloop.net/#/devices/observations/" + sn_value + "/plots?filter=[29,31,32,33,34,35,36,37,38,39,50,70,87,88,89,100]";
            forceFocus();
            if (snCheckEmpty()) {
                return false
            }
            else if (snCheckEQ()) {
                document.getElementById("ml_embed").src = ml_url;
            } else {
                alert("Check Equalizer serial number");
                return false;
            }
        }

        function deratePlots() {
            var sn_value = document.getElementById("sn_id").value;
            var ml_url = "https://portal.masterloop.net/#/devices/observations/" + sn_value + "/plots?filter=[115,114,116,150,151,152,153,154,155,160,161,162,163,170]";
            forceFocus();
            if (snCheckEmpty()) {
                return false
            }
            else if (snCheck()) {
                document.getElementById("ml_embed").src = ml_url;
            } else {
                alert("Check serial number");
                return false;
            }
        }

        function listPlots() {
            var sn_value = document.getElementById("sn_id").value;
            var ml_url = "https://portal.masterloop.net/#/devices/observations/" + sn_value + "/table?filter=[38,46,100,109,110,114,120,128]";
            forceFocus();
            if (snCheckEmpty()) {
                return false
            }
            else if (snCheck()) {
                document.getElementById("ml_embed").src = ml_url;
            } else {
                alert("Check serial number");
                return false;
            }
        }

        function openPortal() {
            var sn_value = document.getElementById("sn_id").value;
            var ml_url = "https://easee.cloud/support/products/navigate-to-site/" + sn_value;
            forceFocus();
            if (snCheckEmpty()) {
                return false
            }
            else if (snCheck()) {
                document.getElementById("ml_embed").src = ml_url;
            } else {
                alert("Check serial number");
                return false;
            }
        }

        function openPortalInfo() {
            var sn_value = document.getElementById("sn_id").value;
            var ml_url = "https://easee.cloud/support/products/view/" + sn_value;
            forceFocus();
            if (snCheckEmpty()) {
                return false
            }
            else if (snCheck()) {
                document.getElementById("ml_embed").src = ml_url;
            } else {
                alert("Check serial number");
                return false;
            }
        }

        //
        //
        //
        //
        //
        //
        //CTRL + mouse click functions to open new tabs
        function setURLCTRL() {
            var sn_value = document.getElementById("sn_id").value;
            var ml_url = "https://portal.masterloop.net/#/devices/general/" + sn_value;
            forceFocus();
            if (snCheckEmpty()) {
                return false
            }
            else if (snCheck()) {
                window.open(ml_url);
            } else {
                alert("Check serial number");
                return false;
            }
        }

        function ObservationsCTRL() {
            var sn_value = document.getElementById("sn_id").value;
            var ml_url = "https://portal.masterloop.net/#/devices/observations/" + sn_value;
            forceFocus();
            if (snCheckEmpty()) {
                return false
            }
            else if (snCheck()) {
                window.open(ml_url);
            } else {
                alert("Check serial number");
                return false;
            }
        }

        function SettingsCTRL() {
            var sn_value = document.getElementById("sn_id").value;
            var ml_url = "https://portal.masterloop.net/#/devices/settings/" + sn_value;
            forceFocus();
            if (snCheckEmpty()) {
                return false
            }
            else if (snCheck()) {
                window.open(ml_url);
            } else {
                alert("Check serial number");
                return false;
            }
        }

        function CommandsCTRL() {
            var sn_value = document.getElementById("sn_id").value;
            var ml_url = "https://portal.masterloop.net/#/devices/quickCommands/" + sn_value;
            forceFocus();
            if (snCheckEmpty()) {
                return false
            }
            else if (snCheck()) {
                window.open(ml_url);
            } else {
                alert("Check serial number");
                return false;
            }
        }

        function HistoryCTRL() {
            var sn_value = document.getElementById("sn_id").value;
            var ml_url = "https://portal.masterloop.net/#/devices/" + sn_value + "/commandsHistory";
            forceFocus();
            if (snCheckEmpty()) {
                return false
            }
            else if (snCheck()) {
                window.open(ml_url);
            } else {
                alert("Check serial number");
                return false;
            }
        }

        function chargerPlotsCTRL() {
            var sn_value = document.getElementById("sn_id").value;
            var ml_url = "https://portal.masterloop.net/#/devices/observations/" + sn_value + "/plots?filter=[21,38,46,96,104,109,110,114,120,182,183,184,185,194,195,196,197,198,199]";
            forceFocus();
            if (snCheckEmpty()) {
                return false
            }
            else if (snCheck()) {
                window.open(ml_url);
            } else {
                alert("Check serial number");
                return false;
            }
        }

        function networkPlotsCTRL() {
            var sn_value = document.getElementById("sn_id").value;
            var ml_url = "https://portal.masterloop.net/#/devices/observations/" + sn_value + "/plots?filter=[11,46,130,131,132,136,150,141]";
            forceFocus();
            if (snCheckEmpty()) {
                return false
            }
            else if (snCheck()) {
                window.open(ml_url);
            } else {
                alert("Check serial number");
                return false;
            }
        }

        function equalizerPlotsCTRL() {
            var sn_value = document.getElementById("sn_id").value;
            var ml_url = "https://portal.masterloop.net/#/devices/observations/" + sn_value + "/plots?filter=[20,31,32,33,34,35,36,50,70,87,89]";
            forceFocus();
            if (snCheckEmpty()) {
                return false
            }
            else if (snCheckEQ()) {
                window.open(ml_url);
            } else {
                alert("Check Equalizer serial number");
                return false;
            }
        }

        function deratePlotsCTRL() {
            var sn_value = document.getElementById("sn_id").value;
            var ml_url = "https://portal.masterloop.net/#/devices/observations/" + sn_value + "/plots?filter=[115,114,116,150,151,152,153,154,155,160,161,162,163,170]";
            forceFocus();
            if (snCheckEmpty()) {
                return false
            }
            else if (snCheck()) {
                window.open(ml_url);
            } else {
                alert("Check serial number");
                return false;
            }
        }

        function listPlotsCTRL() {
            var sn_value = document.getElementById("sn_id").value;
            var ml_url = "https://portal.masterloop.net/#/devices/observations/" + sn_value + "/table?filter=[38,46,100,109,110,114,120,128]";
            forceFocus();
            if (snCheckEmpty()) {
                return false
            }
            else if (snCheck()) {
                window.open(ml_url);
            } else {
                alert("Check serial number");
                return false;
            }
        }

        function openPortalCTRL() {
            var sn_value = document.getElementById("sn_id").value;
            var ml_url = "https://easee.cloud/support/products/navigate-to-site/" + sn_value;
            forceFocus();
            if (snCheckEmpty()) {
                return false
            }
            else if (snCheck()) {
                window.open(ml_url);
            } else {
                alert("Check serial number");
                return false;
            }
        }

        function openPortalInfoCTRL() {
            var sn_value = document.getElementById("sn_id").value;
            var ml_url = "https://easee.cloud/support/products/view/" + sn_value;
            forceFocus();
            if (snCheckEmpty()) {
                return false
            }
            else if (snCheck()) {
                window.open(ml_url);
            } else {
                alert("Check serial number");
                return false;
            }
        }

        ///////////////////////
        //////////////////////

        // Shift click alternatives
        function openPortalSHIFT() {
            var sn_value = document.getElementById("sn_id").value;
            var ml_url = "https://beta.easee.cloud/support/products/navigate-to-site/" + sn_value;
            forceFocus();
            if (snCheckEmpty()) {
                return false
            }
            else if (snCheck()) {
                document.getElementById("ml_embed").src = ml_url;
            } else {
                alert("Check serial number");
                return false;
            }
        }

        function openPortalInfoSHIFT() {
            var sn_value = document.getElementById("sn_id").value;
            var ml_url = "https://beta.easee.cloud/support/products/view/" + sn_value;
            forceFocus();
            if (snCheckEmpty()) {
                return false
            }
            else if (snCheck()) {
                document.getElementById("ml_embed").src = ml_url;
            } else {
                alert("Check serial number");
                return false;
            }
        }

    </script>

</body>

<style>
    #icon {
        max-width: 39px;
        min-width: 39px;
        max-height: 39px;
        min-height: 39px;
        padding-left: 11px;
        padding-right: 11px;
        padding-top: 10px;
        padding-bottom: 15px;
    }

    iframe {
        position: fixed;
        left: 0px;
        background: #007DBD;
    }

    body {
        background-color: #007DBD;
        margin-top: 0px;
    }

    .toolbar button {
        background: #007DBD;
        border: 1px solid #007DBD;
        color: #fff;
        cursor: pointer;
        -webkit-transition: all 0.2s;
        -moz-transition: all 0.2s;
        transition: all 0.2s;
        flex-basis: 120px;
        min-width: 110px;
        max-width: 140px !important;
        margin-bottom: 7px;
        margin-top: 2.5px;
    }

    .toolbar button img {
        vertical-align: middle;
        padding-right: 5px;
        margin-bottom: 3px;
    }

    button.small-buttons {
        flex-basis: 0px !important;
        min-width: 65px;
        padding: auto;
        padding-right: 0px;
        padding-top: 0px;
        padding-bottom: 0px;
        padding-left: 4px;
        margin-bottom: 7px !important;
    }

    button.small-buttons img {
        margin-top: 2px !important;
    }

    button.mini-buttons {
        flex-basis: 0px !important;
        min-width: 40px;
        padding: auto;
        padding-right: 0px;
        padding-top: 0px;
        padding-bottom: 0px;
        padding-left: 4px;
        margin-bottom: 8px !important;
    }

    button.mini-buttons img {
        margin-top: 0px !important;
    }

    button.long-buttons {
        flex-basis: 0px !important;
        min-width: 160px;
        padding: auto;
        padding-right: 0px;
        padding-top: 0px;
        padding-bottom: 0px;
        padding-left: 4px;
    }

    button.long-buttons img {
        vertical-align: middle;
        padding-right: 0px !important;
        margin-right: 5px;
        border-radius: 2.5px;
    }

    #btnCommands {
        padding-left: 7px !important;
    }

    .toolbar button:hover {
        background: #0070a8;
        border-radius: 3px;
    }

    .toolbar {
        display: -webkit-box;
        display: flex;
        z-index: 10;
        position: fixed;
        left: 0px;
        width: 100%;
        height: 60px;
        background: #007DBD;
        overflow: auto;
        overflow: overlay;
        margin-top: 4px;
        overflow-y: hidden;
    }

    .toolbar>* {
        border: 0;
        font-size: 1rem;
        border-radius: 0;
        outline: 0;
        -webkit-appearance: none;
    }

    input[type="text"] {
        flex-basis: 158px;
        padding: 2px 0 0 19px;
        margin-bottom: 7.5px;
        margin-left: 0px;
        margin-right: 7px;
        margin-top: 3px;
        border-radius: 2px;
    }

    ::-webkit-scrollbar {
        width: 20px;
    }

    ::-webkit-scrollbar-track {
        background-color: transparent;
    }

    ::-webkit-scrollbar-thumb {
        background-color: #d6dee100;
        border-radius: 20px;
        border: 6px solid transparent;
        background-clip: content-box;
    }

    ::-webkit-scrollbar-thumb:hover {
        background-color: #a8bbbf;
    }

    ::placeholder {
        color: rgb(161, 161, 161)
    }

    html {
        overflow-y: overlay;
    }
</style>

</html>
